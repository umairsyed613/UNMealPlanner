@page "/viewgrocery/{id}"
@inject IGroceryListService GroceryListService
<style>

    .groceryList ol {
        counter-reset: li;
        list-style: none;
        padding: 0;
        text-shadow: 0 1px 0 rgba(255,255,255,.5);
    }

    .groceryList li {
        position: relative;
        display: block;
        padding: .4em .4em .4em .8em;
        *padding: .4em;
        margin: .5em 0 .5em 2.5em;
        background: #f9f9f9;
        color: #222;
        text-decoration: none;
        transition: all .3s ease-out;
        -webkit-box-shadow: 0 1px 0 rgba(0,0,0,.15);
        -moz-box-shadow: 0 1px 0 rgba(0,0,0,.15);
        box-shadow: 0 1px 0 rgba(0,0,0,.15);
        cursor: pointer;
    }

        .groceryList li:hover {
            background: #f1f1f1;
        }

        .groceryList li:before {
            content: counter(li);
            counter-increment: li;
            position: absolute;
            left: -2.5em;
            top: 50%;
            margin-top: -1em;
            background: #b31132;
            height: 2em;
            width: 2em;
            line-height: 2em;
            text-align: center;
            font-weight: bold;
            color: #f9f9f9;
        }

        .groceryList li:after {
            position: absolute;
            content: '';
            border: .5em solid transparent;
            left: -1em;
            top: 50%;
            margin-top: -.5em;
            transition: all .3s ease-out;
        }

        .groceryList li:hover:after {
            left: -.5em;
            border-left-color: #b31132;
        }
</style>

<div class="d-flex flex-column p-3 border rounded">
    @if (GroceryList == null)
    {
        <div class="spinner-border text-danger" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    }
    else
    {

        <div class="mb-2">
            <h3>@GroceryList.Name</h3>
            <small class="text-muted">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-info mr-1" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                    <path d="M8.93 6.588l-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588z"/>
                    <circle cx="8" cy="4.5" r="1"/>
                </svg>Tap on the grocery item to mark it as done.
            </small>
            <hr />
        </div>

        <div class="groceryList mb-2">
            <ol>
                @foreach (var item in GroceryList.Items)
                {
                    <li @onclick="@(() => MarkItemCompleted(item.Key))" data-toggle="tooltip" data-placement="top" title="Tap to mark it completed">
                        <div class="d-flex flex-row flex-nowrap justify-content-between">
                            <div>
                                @if (item.IsCompleted)
                                {
                                    <s>@item.Name</s>
                                }
                                else
                                {
                                    @item.Name
                                }
                            </div>
                            <div>@item.Quantity <small class="text-muted">/ Qty</small></div>
                        </div>
                    </li>
                }
            </ol>
        </div>
    }
</div>

<CustomNavigator />

@code {
    [Parameter]
    public string id { get; set; }

    private GroceryList GroceryList;


    protected override async Task OnParametersSetAsync()
    {
        GroceryList = await GroceryListService.GetGroceryListById(id);
    }

    private async Task MarkItemCompleted(string key)
    {
        var item = GroceryList.Items.FirstOrDefault(f => f.Key == key);

        if (item != null)
        {
            item.IsCompleted = !item.IsCompleted;
        }

        await GroceryListService.UpsertGroceryList(GroceryList);
        GroceryList = await GroceryListService.GetGroceryListById(id);
        StateHasChanged();
    }

}
